#!/bin/bash
# Bidirectional rsync script for some home dirs.
# Mainly useful for syncing stuff between my phone and laptop.

sync_dirs='
docs
music
'
# -v verbose
# -h human readable numbers
# -r recursive
# -u skip files that are newer on the receiver
# -l copy symlinks as symlinks
# -t preserve modification times
# -p preserve permissions
# -E preserve executability
# -e specify the remote shell to use (e.g. for termux sshd: -e 'ssh -p 8022')
# -n dry run
pull_opts="-vhrute 'ssh -p 8022'"
push_opts="-vhrute 'ssh -p 8022'"

if [[ $# -ne 1 || $1 == -* ]]; then
	echo "Usage: $0 [user@]host" >&2
	exit 1
fi

set -e
for dir in $sync_dirs; do
	printf "\nPulling %s\n" "$dir"
	cmd="rsync $pull_opts $1:$dir/ $HOME/$dir"
	echo "$cmd"
	eval "$cmd"

	printf "\nPushing %s\n" "$dir"
	cmd="rsync $push_opts $HOME/$dir/ $1:$dir"
	echo "$cmd"
	eval "$cmd"
done
